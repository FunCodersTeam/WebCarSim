THREE.TransformControls=function(n,t){function i(n,t){var i=t;Object.defineProperty(r,n,{get:function(){return i!==undefined?i:t},set:function(t){i!==t&&(i=t,v[n]=t,w[n]=t,r.dispatchEvent({type:n+"-changed",value:t}),r.dispatchEvent(st))}});r[n]=t;v[n]=t;w[n]=t}function b(n){var r=n.changedTouches?n.changedTouches[0]:n,i=t.getBoundingClientRect();return{x:(r.clientX-i.left)/i.width*2-1,y:-(r.clientY-i.top)/i.height*2+1,button:n.button}}function rt(n){r.enabled&&r.pointerHover(b(n))}function ut(n){r.enabled&&(document.addEventListener("mousemove",k,!1),r.pointerHover(b(n)),r.pointerDown(b(n)))}function k(n){r.enabled&&r.pointerMove(b(n))}function l(n){r.enabled&&(document.removeEventListener("mousemove",k,!1),r.pointerUp(b(n)))}var w,v,r;THREE.Object3D.call(this);t=t!==undefined?t:document;this.visible=!1;w=new THREE.TransformControlsGizmo;this.add(w);v=new THREE.TransformControlsPlane;this.add(v);r=this;i("camera",n);i("object",undefined);i("enabled",!0);i("axis",null);i("mode","translate");i("translationSnap",null);i("rotationSnap",null);i("space","world");i("size",1);i("dragging",!1);i("showX",!0);i("showY",!0);i("showZ",!0);var st={type:"change"},ht={type:"mouseDown"},ct={type:"mouseUp",mode:r.mode},dt={type:"objectChange"},y=new THREE.Raycaster,f=new THREE.Vector3,h=new THREE.Vector3,ft=new THREE.Quaternion,lt={X:new THREE.Vector3(1,0,0),Y:new THREE.Vector3(0,1,0),Z:new THREE.Vector3(0,0,1)},o=new THREE.Vector3,s=new THREE.Vector3,u=new THREE.Vector3,c=new THREE.Vector3,at=new THREE.Vector3,vt=new THREE.Vector3,e=0,d=new THREE.Vector3,yt=new THREE.Quaternion,gt=new THREE.Vector3,ni=new THREE.Vector3,pt=new THREE.Quaternion,et=new THREE.Quaternion,ot=new THREE.Vector3,g=new THREE.Vector3,wt=new THREE.Quaternion,ti=new THREE.Vector3,nt=new THREE.Vector3,tt=new THREE.Quaternion,it=new THREE.Quaternion,ii=new THREE.Vector3,a=new THREE.Vector3,bt=new THREE.Vector3,p=new THREE.Quaternion,kt=new THREE.Vector3;i("worldPosition",nt);i("worldPositionStart",g);i("worldQuaternion",tt);i("worldQuaternionStart",wt);i("cameraPosition",d);i("cameraQuaternion",yt);i("pointStart",o);i("pointEnd",s);i("rotationAxis",c);i("rotationAngle",e);i("eye",a);t.addEventListener("mousedown",ut,!1);t.addEventListener("touchstart",ut,!1);t.addEventListener("mousemove",rt,!1);t.addEventListener("touchmove",rt,!1);t.addEventListener("touchmove",k,!1);document.addEventListener("mouseup",l,!1);t.addEventListener("touchend",l,!1);t.addEventListener("touchcancel",l,!1);t.addEventListener("touchleave",l,!1);this.dispose=function(){t.removeEventListener("mousedown",ut);t.removeEventListener("touchstart",ut);t.removeEventListener("mousemove",rt);document.removeEventListener("mousemove",k);t.removeEventListener("touchmove",rt);t.removeEventListener("touchmove",k);document.removeEventListener("mouseup",l);t.removeEventListener("touchend",l);t.removeEventListener("touchcancel",l);t.removeEventListener("touchleave",l);this.traverse(function(n){n.geometry&&n.geometry.dispose();n.material&&n.material.dispose()})};this.attach=function(n){this.object=n;this.visible=!0};this.detach=function(){this.object=undefined;this.visible=!1;this.axis=null};this.updateMatrixWorld=function(){this.object!==undefined&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(ni,pt,ot),this.object.matrixWorld.decompose(nt,tt,ii),et.copy(pt).inverse(),it.copy(tt).inverse());this.camera.updateMatrixWorld();this.camera.matrixWorld.decompose(d,yt,gt);this.camera instanceof THREE.PerspectiveCamera?a.copy(d).sub(nt).normalize():this.camera instanceof THREE.OrthographicCamera&&a.copy(d).normalize();THREE.Object3D.prototype.updateMatrixWorld.call(this)};this.pointerHover=function(n){if(this.object!==undefined&&this.dragging!==!0&&(n.button===undefined||n.button===0)){y.setFromCamera(n,this.camera);var t=y.intersectObjects(w.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}};this.pointerDown=function(n){var r,i,t;this.object!==undefined&&this.dragging!==!0&&(n.button===undefined||n.button===0)&&(n.button===0||n.button===undefined)&&this.axis!==null&&(y.setFromCamera(n,this.camera),r=y.intersectObjects([v],!0)[0]||!1,r&&(i=this.space,this.mode==="scale"?i="local":(this.axis==="E"||this.axis==="XYZE"||this.axis==="XYZ")&&(i="world"),i==="local"&&this.mode==="rotate"&&(t=this.rotationSnap,this.axis==="X"&&t&&(this.object.rotation.x=Math.round(this.object.rotation.x/t)*t),this.axis==="Y"&&t&&(this.object.rotation.y=Math.round(this.object.rotation.y/t)*t),this.axis==="Z"&&t&&(this.object.rotation.z=Math.round(this.object.rotation.z/t)*t)),this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),bt.copy(this.object.position),p.copy(this.object.quaternion),kt.copy(this.object.scale),this.object.matrixWorld.decompose(g,wt,ti),o.copy(r.point).sub(g)),this.dragging=!0,ht.mode=this.mode,this.dispatchEvent(ht))};this.pointerMove=function(n){var t=this.axis,w=this.mode,i=this.object,r=this.space,b,l,k;(w==="scale"?r="local":(t==="E"||t==="XYZE"||t==="XYZ")&&(r="world"),i!==undefined&&t!==null&&this.dragging!==!1&&(n.button===undefined||n.button===0))&&(y.setFromCamera(n,this.camera),b=y.intersectObjects([v],!0)[0]||!1,b!==!1)&&(s.copy(b.point).sub(g),w==="translate"?(u.copy(s).sub(o),r==="local"&&t!=="XYZ"&&u.applyQuaternion(it),t.indexOf("X")===-1&&(u.x=0),t.indexOf("Y")===-1&&(u.y=0),t.indexOf("Z")===-1&&(u.z=0),r==="local"&&t!=="XYZ"?u.applyQuaternion(p).divide(ot):u.applyQuaternion(et).divide(ot),i.position.copy(u).add(bt),this.translationSnap&&(r==="local"&&(i.position.applyQuaternion(ft.copy(p).inverse()),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(p)),r==="world"&&(i.parent&&i.position.add(f.setFromMatrixPosition(i.parent.matrixWorld)),t.search("X")!==-1&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(f.setFromMatrixPosition(i.parent.matrixWorld))))):w==="scale"?(t.search("XYZ")!==-1?(l=s.length()/o.length(),s.dot(o)<0&&(l*=-1),h.set(l,l,l)):(f.copy(o),h.copy(s),f.applyQuaternion(it),h.applyQuaternion(it),h.divide(f),t.search("X")===-1&&(h.x=1),t.search("Y")===-1&&(h.y=1),t.search("Z")===-1&&(h.z=1)),i.scale.copy(kt).multiply(h)):w==="rotate"&&(u.copy(s).sub(o),k=20/nt.distanceTo(f.setFromMatrixPosition(this.camera.matrixWorld)),t==="E"?(c.copy(a),e=s.angleTo(o),at.copy(o).normalize(),vt.copy(s).normalize(),e*=vt.cross(at).dot(a)<0?1:-1):t==="XYZE"?(c.copy(u).cross(a).normalize(),e=u.dot(f.copy(c).cross(this.eye))*k):(t==="X"||t==="Y"||t==="Z")&&(c.copy(lt[t]),f.copy(lt[t]),r==="local"&&f.applyQuaternion(tt),e=u.dot(f.cross(a).normalize())*k),this.rotationSnap&&(e=Math.round(e/this.rotationSnap)*this.rotationSnap),this.rotationAngle=e,r==="local"&&t!=="E"&&t!=="XYZE"?(i.quaternion.copy(p),i.quaternion.multiply(ft.setFromAxisAngle(c,e)).normalize()):(c.applyQuaternion(et),i.quaternion.copy(ft.setFromAxisAngle(c,e)),i.quaternion.multiply(p).normalize())),this.dispatchEvent(st),this.dispatchEvent(dt))};this.pointerUp=function(n){(n.button===undefined||n.button===0)&&(this.dragging&&this.axis!==null&&(ct.mode=this.mode,this.dispatchEvent(ct)),this.dragging=!1,n.button===undefined&&(this.axis=null))};this.getMode=function(){return r.mode};this.setMode=function(n){r.mode=n};this.setTranslationSnap=function(n){r.translationSnap=n};this.setRotationSnap=function(n){r.rotationSnap=n};this.setSize=function(n){r.size=n};this.setSpace=function(n){r.space=n};this.update=function(){console.warn("THREE.TransformControls: update function has been depricated.")}};THREE.TransformControls.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControls,isTransformControls:!0});THREE.TransformControlsGizmo=function(){"use strict";var u,v,y,p,f,ut,ft,et,lt,d,g,nt,w,b,c,ht,l;THREE.Object3D.call(this);this.type="TransformControlsGizmo";var s=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:THREE.DoubleSide,fog:!1}),h=new THREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),t=s.clone();t.opacity=.15;u=s.clone();u.opacity=.33;v=s.clone();v.color.set(16711680);y=s.clone();y.color.set(65280);p=s.clone();p.color.set(255);f=s.clone();f.opacity=.25;ut=f.clone();ut.color.set(16776960);ft=f.clone();ft.color.set(65535);et=f.clone();et.color.set(16711935);lt=s.clone();lt.color.set(16776960);d=h.clone();d.color.set(16711680);g=h.clone();g.color.set(65280);nt=h.clone();nt.color.set(255);w=h.clone();w.color.set(65535);b=h.clone();b.color.set(16711935);c=h.clone();c.color.set(16776960);ht=h.clone();ht.color.set(7895160);l=c.clone();l.opacity=.25;var k=new THREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),e=new THREE.BoxBufferGeometry(.125,.125,.125),n=new THREE.BufferGeometry;n.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,0,0],3));var tt=function(n,t){for(var r=new THREE.BufferGeometry,u=[],i=0;i<=64*t;++i)u.push(0,Math.cos(i/32*Math.PI)*n,Math.sin(i/32*Math.PI)*n);return r.addAttribute("position",new THREE.Float32BufferAttribute(u,3)),r},yt=function(){var n=new THREE.BufferGeometry;return n.addAttribute("position",new THREE.Float32BufferAttribute([0,0,0,1,1,1],3)),n},pt={X:[[new THREE.Mesh(k,v),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new THREE.Mesh(k,v),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new THREE.Line(n,d)]],Y:[[new THREE.Mesh(k,y),[0,1,0],null,null,"fwd"],[new THREE.Mesh(k,y),[0,1,0],[Math.PI,0,0],null,"bwd"],[new THREE.Line(n,g),null,[0,0,Math.PI/2]]],Z:[[new THREE.Mesh(k,p),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new THREE.Mesh(k,p),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new THREE.Line(n,nt),null,[0,-Math.PI/2,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.1,0),f),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),ut),[.15,.15,0]],[new THREE.Line(n,c),[.18,.3,0],null,[.125,1,1]],[new THREE.Line(n,c),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),ft),[0,.15,.15],[0,Math.PI/2,0]],[new THREE.Line(n,w),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(n,w),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.295,.295),et),[.15,0,.15],[-Math.PI/2,0,0]],[new THREE.Line(n,b),[.18,0,.3],null,[.125,1,1]],[new THREE.Line(n,b),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},wt={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),t),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),t),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,1,4,1,!1),t),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.2,0),t)]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),t),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),t),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),t),[.2,0,.2],[-Math.PI/2,0,0]]]},bt={START:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),u),null,null,null,"helper"]],END:[[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.01,2),u),null,null,null,"helper"]],DELTA:[[new THREE.Line(yt(),u),null,null,null,"helper"]],X:[[new THREE.Line(n,u.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(n,u.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(n,u.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},kt={X:[[new THREE.Line(tt(1,.5),d)],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),v),[0,0,.99],null,[1,3,1]],],Y:[[new THREE.Line(tt(1,.5),g),null,[0,0,-Math.PI/2]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),y),[0,0,.99],null,[3,1,1]],],Z:[[new THREE.Line(tt(1,.5),nt),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.OctahedronBufferGeometry(.04,0),p),[.99,0,0],null,[1,3,1]],],E:[[new THREE.Line(tt(1.25,1),l),null,[0,Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),l),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),l),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),l),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new THREE.Mesh(new THREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),l),[0,1.17,0],[0,0,0],[1,1,.001]],],XYZE:[[new THREE.Line(tt(1,1),ht),null,[0,Math.PI/2,0]]]},dt={AXIS:[[new THREE.Line(n,u.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},gt={X:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),t),[0,0,0],[0,-Math.PI/2,-Math.PI/2]],],Y:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),t),[0,0,0],[Math.PI/2,0,0]],],Z:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1,.1,4,24),t),[0,0,0],[0,0,-Math.PI/2]],],E:[[new THREE.Mesh(new THREE.TorusBufferGeometry(1.25,.1,2,24),t)]],XYZE:[[new THREE.Mesh(new THREE.SphereBufferGeometry(.7,10,8),t)]]},ni={X:[[new THREE.Mesh(e,v),[.8,0,0],[0,0,-Math.PI/2]],[new THREE.Line(n,d),null,null,[.8,1,1]]],Y:[[new THREE.Mesh(e,y),[0,.8,0]],[new THREE.Line(n,g),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new THREE.Mesh(e,p),[0,0,.8],[Math.PI/2,0,0]],[new THREE.Line(n,nt),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new THREE.Mesh(e,ut),[.85,.85,0],null,[2,2,.2]],[new THREE.Line(n,c),[.855,.98,0],null,[.125,1,1]],[new THREE.Line(n,c),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new THREE.Mesh(e,ft),[0,.85,.85],null,[.2,2,2]],[new THREE.Line(n,w),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new THREE.Line(n,w),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new THREE.Mesh(e,et),[.85,0,.85],null,[2,.2,2]],[new THREE.Line(n,b),[.855,0,.98],null,[.125,1,1]],[new THREE.Line(n,b),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),f),[1.1,0,0]],],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),f),[0,1.1,0]],],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.125,.125,.125),f),[0,0,1.1]],]},ti={X:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),t),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),t),[0,.5,0]]],Z:[[new THREE.Mesh(new THREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),t),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new THREE.Mesh(e,t),[.85,.85,0],null,[3,3,.2]],],YZ:[[new THREE.Mesh(e,t),[0,.85,.85],null,[.2,3,3]],],XZ:[[new THREE.Mesh(e,t),[.85,0,.85],null,[3,.2,3]],],XYZX:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),t),[1.1,0,0]],],XYZY:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),t),[0,1.1,0]],],XYZZ:[[new THREE.Mesh(new THREE.BoxBufferGeometry(.2,.2,.2),t),[0,0,1.1]],]},ii={X:[[new THREE.Line(n,u.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new THREE.Line(n,u.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new THREE.Line(n,u.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},o=function(n){var s=new THREE.Object3D,i,r,o;for(i in n)for(r=n[i].length;r--;){var t=n[i][r][0].clone(),u=n[i][r][1],f=n[i][r][2],e=n[i][r][3],h=n[i][r][4];t.name=i;t.tag=h;u&&t.position.set(u[0],u[1],u[2]);f&&t.rotation.set(f[0],f[1],f[2]);e&&t.scale.set(e[0],e[1],e[2]);t.updateMatrix();o=t.geometry.clone();o.applyMatrix(t.matrix);t.geometry=o;t.renderOrder=Infinity;t.position.set(0,0,0);t.rotation.set(0,0,0);t.scale.set(1,1,1);s.add(t)}return s},ct=new THREE.Vector3(0,0,0),ot=new THREE.Euler,i=new THREE.Vector3(0,1,0),at=new THREE.Vector3(0,0,0),vt=new THREE.Matrix4,r=new THREE.Quaternion,st=new THREE.Quaternion,ri=new THREE.Quaternion,it=new THREE.Vector3(1,0,0),a=new THREE.Vector3(0,1,0),rt=new THREE.Vector3(0,0,1);this.gizmo={};this.picker={};this.helper={};this.add(this.gizmo.translate=o(pt));this.add(this.gizmo.rotate=o(kt));this.add(this.gizmo.scale=o(ni));this.add(this.picker.translate=o(wt));this.add(this.picker.rotate=o(gt));this.add(this.picker.scale=o(ti));this.add(this.helper.translate=o(bt));this.add(this.helper.rotate=o(dt));this.add(this.helper.scale=o(ii));this.picker.translate.visible=!1;this.picker.rotate.visible=!1;this.picker.scale.visible=!1;this.updateMatrixWorld=function(){var h=this.space,t,u,f,n,c;for(this.mode==="scale"&&(h="local"),t=h==="local"?this.worldQuaternion:ri,this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale",u=[],u=u.concat(this.picker[this.mode].children),u=u.concat(this.gizmo[this.mode].children),u=u.concat(this.helper[this.mode].children),f=0;f<u.length;f++){if(n=u[f],n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition),c=this.worldPosition.distanceTo(this.cameraPosition),n.scale.set(1,1,1).multiplyScalar(c*this.size/7),n.tag==="helper"){n.visible=!1;n.name==="AXIS"?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,this.axis==="X"&&(r.setFromEuler(ot.set(0,0,0)),n.quaternion.copy(t).multiply(r),Math.abs(i.copy(it).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Y"&&(r.setFromEuler(ot.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(r),Math.abs(i.copy(a).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="Z"&&(r.setFromEuler(ot.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(r),Math.abs(i.copy(rt).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),this.axis==="XYZE"&&(r.setFromEuler(ot.set(0,Math.PI/2,0)),i.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(vt.lookAt(at,i,a)),n.quaternion.multiply(r),n.visible=this.dragging),this.axis==="E"&&(n.visible=!1)):n.name==="START"?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):n.name==="END"?(n.position.copy(this.worldPosition),n.visible=this.dragging):n.name==="DELTA"?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),ct.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ct.applyQuaternion(this.worldQuaternionStart.clone().inverse()),n.scale.copy(ct),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=this.axis.search(n.name)!==-1));continue}if(n.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"){var e=.99,o=.2,s=0;(n.name==="X"||n.name==="XYZX")&&Math.abs(i.copy(it).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1);(n.name==="Y"||n.name==="XYZY")&&Math.abs(i.copy(a).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1);(n.name==="Z"||n.name==="XYZZ")&&Math.abs(i.copy(rt).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1);n.name==="XY"&&Math.abs(i.copy(rt).applyQuaternion(t).dot(this.eye))<o&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1);n.name==="YZ"&&Math.abs(i.copy(it).applyQuaternion(t).dot(this.eye))<o&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1);n.name==="XZ"&&Math.abs(i.copy(a).applyQuaternion(t).dot(this.eye))<o&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1);n.name.search("X")!==-1&&(i.copy(it).applyQuaternion(t).dot(this.eye)<s?n.tag==="fwd"?n.visible=!1:n.scale.x*=-1:n.tag==="bwd"&&(n.visible=!1));n.name.search("Y")!==-1&&(i.copy(a).applyQuaternion(t).dot(this.eye)<s?n.tag==="fwd"?n.visible=!1:n.scale.y*=-1:n.tag==="bwd"&&(n.visible=!1));n.name.search("Z")!==-1&&(i.copy(rt).applyQuaternion(t).dot(this.eye)<s?n.tag==="fwd"?n.visible=!1:n.scale.z*=-1:n.tag==="bwd"&&(n.visible=!1))}else this.mode==="rotate"&&(st.copy(t),i.copy(this.eye).applyQuaternion(r.copy(t).inverse()),n.name.search("E")!==-1&&n.quaternion.setFromRotationMatrix(vt.lookAt(this.eye,at,a)),n.name==="X"&&(r.setFromAxisAngle(it,Math.atan2(-i.y,i.z)),r.multiplyQuaternions(st,r),n.quaternion.copy(r)),n.name==="Y"&&(r.setFromAxisAngle(a,Math.atan2(i.x,i.z)),r.multiplyQuaternions(st,r),n.quaternion.copy(r)),n.name==="Z"&&(r.setFromAxisAngle(rt,Math.atan2(i.y,i.x)),r.multiplyQuaternions(st,r),n.quaternion.copy(r)));n.visible=n.visible&&(n.name.indexOf("X")===-1||this.showX);n.visible=n.visible&&(n.name.indexOf("Y")===-1||this.showY);n.visible=n.visible&&(n.name.indexOf("Z")===-1||this.showZ);n.visible=n.visible&&(n.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ);n.material._opacity=n.material._opacity||n.material.opacity;n.material._color=n.material._color||n.material.color.clone();n.material.color.copy(n.material._color);n.material.opacity=n.material._opacity;this.enabled?this.axis&&(n.name===this.axis?(n.material.opacity=1,n.material.color.lerp(new THREE.Color(1,1,1),.5)):this.axis.split("").some(function(t){return n.name===t})?(n.material.opacity=1,n.material.color.lerp(new THREE.Color(1,1,1),.5)):(n.material.opacity*=.25,n.material.color.lerp(new THREE.Color(1,1,1),.5))):(n.material.opacity*=.5,n.material.color.lerp(new THREE.Color(1,1,1),.5))}THREE.Object3D.prototype.updateMatrixWorld.call(this)}};THREE.TransformControlsGizmo.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.TransformControlsGizmo,isTransformControlsGizmo:!0});THREE.TransformControlsPlane=function(){"use strict";THREE.Mesh.call(this,new THREE.PlaneBufferGeometry(1e5,1e5,2,2),new THREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:THREE.DoubleSide,transparent:!0,opacity:.1}));this.type="TransformControlsPlane";var u=new THREE.Vector3(1,0,0),i=new THREE.Vector3(0,1,0),r=new THREE.Vector3(0,0,1),o=new THREE.Vector3,n=new THREE.Vector3,t=new THREE.Vector3,e=new THREE.Matrix4,f=new THREE.Quaternion;this.updateMatrixWorld=function(){var s=this.space;this.position.copy(this.worldPosition);this.mode==="scale"&&(s="local");u.set(1,0,0).applyQuaternion(s==="local"?this.worldQuaternion:f);i.set(0,1,0).applyQuaternion(s==="local"?this.worldQuaternion:f);r.set(0,0,1).applyQuaternion(s==="local"?this.worldQuaternion:f);t.copy(i);switch(this.mode){case"translate":case"scale":switch(this.axis){case"X":t.copy(this.eye).cross(u);n.copy(u).cross(t);break;case"Y":t.copy(this.eye).cross(i);n.copy(i).cross(t);break;case"Z":t.copy(this.eye).cross(r);n.copy(r).cross(t);break;case"XY":n.copy(r);break;case"YZ":n.copy(u);break;case"XZ":t.copy(r);n.copy(i);break;case"XYZ":case"E":n.set(0,0,0)}break;case"rotate":default:n.set(0,0,0)}n.length()===0?this.quaternion.copy(this.cameraQuaternion):(e.lookAt(o.set(0,0,0),n,t),this.quaternion.setFromRotationMatrix(e));THREE.Object3D.prototype.updateMatrixWorld.call(this)}};THREE.TransformControlsPlane.prototype=Object.assign(Object.create(THREE.Mesh.prototype),{constructor:THREE.TransformControlsPlane,isTransformControlsPlane:!0})